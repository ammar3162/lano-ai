export default async function handler(req, res) {
  try {
    const { messages } = req.body;

    // ุชุญูู ูู ูุฌูุฏ ุงูููุชุงุญ ูู ุจูุฆุฉ Vercel
    const apiKey = process.env.OPENAI_API_KEY;
    if (!apiKey) {
      return res.status(500).json({
        error: "โ ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุงุญ OpenAI ูู ุฅุนุฏุงุฏุงุช Vercel",
      });
    }

    // ุฅุนุฏุงุฏ ุงูุทูุจ ุฅูู OpenAI
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`,
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [
          {
            role: "system",
            content: `
            ุฃูุช ูุณุงุนุฏ ุฐูู ุฎุงุต ุจูุทุนู ูุงูู (Lano Restaurant) ๐.
            ูููุชู ูู ุงูุฅุฌุงุจุฉ ููุท ุนู ุงูุฃุณุฆูุฉ ุงููุชุนููุฉ ุจุงููุทุนูุ ุงูุฃููุ ุงูููููุ ุฃู ุชุฌุฑุจุฉ ุงูุนููุงุก.
            ุฅุฐุง ุณูุฆูุช ุนู ุฃู ุดูุก ุขุฎุฑ ุบูุฑ ูุทุนู ูุงููุ ูู ุจูุทู:
            "ุฃูุง ููุท ูุณุงุนุฏ ุฎุงุต ุจูุทุนู ูุงูู ๐ุ ูู ุชุฑุบุจ ุฃู ุฃุณุงุนุฏู ูู ูุนุฑูุฉ ูููู ูุงูู ุฃู ุงูุฃุตูุงู ุงููููุฒุฉุ"

            ูุนูููุงุช ุงููุทุนู ุงูุฑุณููุฉ:
            - ๐๏ธ ุงูุชุฃุณูุณ: ุนุงู 2027 ุนูู ูุฏ ุงูุดูู ููู.
            - ๐ ุงููููุน: ุตุจูุงุ ุฌุงุฒุงู โ [Google Maps](https://maps.app.goo.gl/zvkTWhoxfyRjeDFb94)
            - ๐ ุณุงุนุงุช ุงูุนูู: ูู 5 ุงูุนุตุฑ ุฅูู 2 ุตุจุงุญุงู (ููู ุงูููููุฏ ุญุชู 3 ุตุจุงุญุงู)
            - โ๏ธ ุงูุชูุงุตู: 0582003125
            - ๐ ุงูุทูุจุงุช: ูููุฑุณุชูุดู ุฃู ุนุจุฑ ุงูููุฏูุจูู
            - ๐ธ ุฅูุณุชุบุฑุงู: https://www.instagram.com/lano_pasta/?hl=ar
            - ๐ต ุชูู ุชูู: ูุฑูุจุงู
            - ๐ ุงูุฃุทุจุงู ุงููููุฒุฉ: ุจูุชุฒุง ูุงููุ ุจูุชุฒุง ุชุฑุงููุ ุจุงุณุชุง ุงูุจูุณุชูุ ูุงุฒุงููุงุ ููุชุชุดูููุ ุฑูุฒูุชูุ ูุฑุงุช ุงูุจุทุงุทุณ
            - ๐ฟ ููุณูุฉ ุงููุทุนู: ุงูุฌููุฏุฉุ ุงูุทุฒุงุฌุฉุ ุงูุฅุจุฏุงุนุ ูููุณุฉ ุฎูุงููุฉ ูู ูู ุทุจู
            - ๐ฉโ๐ณ ุงูุดูู ุงููุคุณุณุฉ: ููู
            - ๐ ูุฑูุนูุง: ุญุงููุงู ูู ุตุจูุง ููุทุ ููุณุนู ููุชูุณุน ูุฑูุจุงู ูู ุฌุงุฒุงู ูุจุงูู ุงูููุงุทู.
            `,
          },
          ...messages,
        ],
      }),
    });

    const data = await response.json();

    if (data.error) {
      console.error("OpenAI Error:", data.error);
      return res.status(500).json({ error: data.error.message });
    }

    // ุฅุฑุณุงู ุงูุฑุฏ
    res.status(200).json({
      reply: data.choices[0].message.content,
    });
  } catch (error) {
    console.error("Server Error:", error);
    res.status(500).json({ error: "ุญุฏุซ ุฎุทุฃ ูู ุงูุฎุงุฏูุ ุญุงูู ูุงุญูุงู." });
  }
}
